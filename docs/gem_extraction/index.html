
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../flux_balance_analysis/">
      
      
        <link rel="next" href="../gem_comparison/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.14">
    
    
      
        <title>GEM extraction using ftINIT - Human-GEM Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gem-extraction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Human-GEM Guide" class="md-header__button md-logo" aria-label="Human-GEM Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Human-GEM Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GEM extraction using ftINIT
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Human-GEM Guide" class="md-nav__button md-logo" aria-label="Human-GEM Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Human-GEM Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../flux_balance_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flux balance analysis
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    GEM extraction using ftINIT
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    GEM extraction using ftINIT
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fast-taskdriven-integrative-network-inference-for-tissues-ftinit" class="md-nav__link">
    <span class="md-ellipsis">
      Fast Task‚Äêdriven Integrative Network Inference for Tissues (ftINIT)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieve-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve the data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-and-prepare-the-reference-model-for-use-with-ftinit" class="md-nav__link">
    <span class="md-ellipsis">
      Load and prepare the reference model for use with ftINIT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-transcriptomic-data" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare the transcriptomic data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-ftinit" class="md-nav__link">
    <span class="md-ellipsis">
      Run ftINIT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-ftinit-for-all-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Run ftINIT for all samples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-examination-of-the-models" class="md-nav__link">
    <span class="md-ellipsis">
      Quick examination of the models
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gem_comparison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GEM comparison
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gem_extraction_sc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GEM extraction from scRNA-Seq data
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gene_essentiality/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene essentiality with DepMap
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../additional_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional tools
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq_troubleshoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQs and troubleshooting
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fast-taskdriven-integrative-network-inference-for-tissues-ftinit" class="md-nav__link">
    <span class="md-ellipsis">
      Fast Task‚Äêdriven Integrative Network Inference for Tissues (ftINIT)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieve-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve the data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-and-prepare-the-reference-model-for-use-with-ftinit" class="md-nav__link">
    <span class="md-ellipsis">
      Load and prepare the reference model for use with ftINIT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-transcriptomic-data" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare the transcriptomic data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-ftinit" class="md-nav__link">
    <span class="md-ellipsis">
      Run ftINIT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-ftinit-for-all-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Run ftINIT for all samples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-examination-of-the-models" class="md-nav__link">
    <span class="md-ellipsis">
      Quick examination of the models
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="gem-extraction">GEM Extraction</h1>
<p>Human-GEM is a generic model of human metabolism, meaning that it contains metabolic reactions known to occur in any human cell. The model is therefore not representative of any one tissue or cell type, in which only a subset of the reactions would be active.</p>
<p>A common approach is to extract the subset of the GEM that is likely to be active in the tissue or cell type of interest, based on a corresponding dataset (e.g., transcriptomics, proteomics, metabolomics, etc.). This approach is often referred to as <em>GEM extraction</em> or <em>contextualization</em>, where the generated model is termed the <em>extracted</em> or <em>contextualized</em>/<em>context-specific GEM</em>.</p>
<h2 id="fast-taskdriven-integrative-network-inference-for-tissues-ftinit">Fast Task‚Äêdriven Integrative Network Inference for Tissues (ftINIT)</h2>
<p>Although many GEM extraction methods exist, this guide will cover the ftINIT algorithm. For more details on the algorithm, see the following papers:</p>
<ol>
<li><a href="https://doi.org/10.1371/journal.pcbi.1002518">Agren <em>et al.</em> (2012) <em>PLoS Comput Biol</em></a> - Initial development of INIT</li>
<li><a href="https://doi.org/10.1002/msb.145122">Agren <em>et al.</em> (2014) <em>Mol Syst Biol</em></a> - Incorporation of metabolic tasks (tINIT)</li>
<li><a href="https://doi.org/10.1126/scisignal.aaz1482">Robinson <em>et al.</em> (2020) <em>Sci Signal</em></a> - Recognition of enzyme complexes</li>
<li><a href="https://doi.org/10.1073/pnas.2217868120">Gustafsson <em>et al.</em> (2022) <em>PNAS</em></a> - ftINIT, faster and produces less gaps in the models</li>
</ol>
<p>The ftINIT algorithm is available in the RAVEN Toolbox, and we use it together with help functions for Human-GEM available in the Human-GEM repository.</p>
<p>To support users of the previous algorithm (tINIT), we also include a <a href="../gem_extraction_old_tINIT/">guide</a> for the previous (2020) version of tINIT, called the <code>getINITModel2</code> function.</p>
<h2 id="retrieve-the-data">Retrieve the data</h2>
<p>To demonstrate the use of ftINIT, we will walk through an example where we generate models from GTEx data. For simplicity, we extracted 60 RNA-Seq profiles from in total 12 tissues. The data can be downloaded <a href="https://doi.org/10.5281/zenodo.6811073">here</a>  together with other data useful for this tutorial. </p>
<p>Download the Zenodo repository .zip file, and extract.</p>
<h2 id="load-and-prepare-the-reference-model-for-use-with-ftinit">Load and prepare the reference model for use with ftINIT</h2>
<p>The reference GEM from which the tissue-specific models will be extracted is Human-GEM. Load the model from the <code>Human-GEM.mat</code> file in the Human-GEM repository</p>
<pre><code class="language-matlab">load('Human-GEM.mat');  % loads model as a structure named &quot;ihuman&quot;
</code></pre>
<p>ftINIT has a preparation step that needs to be run once for a reference model such as Human-GEM. The purpose of the preparation step is to make calculations in advance to reduce the time it takes to generate each context-specific model. The result is a prepData structure that contains various information needed by ftINIT. This operation takes 1-2 hours on a standard laptop computer, so make sure to save it once it has completed. For version 1.12.0 of Human-GEM, the prepData is available in the Zenodo .zip file.</p>
<pre><code class="language-matlab">% The second flag indicates if the model should be converted to gene symbols from ENSEMBL. This has to be decided at this point.
% Replace path/to/HumanGEM with your local path to the Human-GEM repo root.
% For use with animal models derived from Human-GEM, such as Mouse-GEM, both the model and paths needs to be replaced. Also, 
% the convert genes flag may be irrelevant depending on the if ENSEMBL genes are used in that model.
prepData = prepHumanModelForftINIT(ihuman, false, 'path/to/HumanGEM/data/metabolicTasks/metabolicTasks_Essential.txt', 'path/to/HumanGEM/model/reactions.tsv');
save('prepData.mat', 'prepData')
</code></pre>
<p><code>prepHumanModelForftINIT</code> tests that the reference model (Human-GEM) can successfully perform all essential metabolic tasks (defined in <code>data/metabolicTasks/metabolicTasks_Essential.txt</code>), which is an important step. If the reference model cannot perform a task, then neither can any GEM extracted from that model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The exchange reactions should all be unbounded (e.g., lower and upper bounds of -1000 and 1000, respectively). Human-GEM is already provided in this format, so no additional changes are needed.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function <code>prepHumanModelForftINIT</code> will automatically use the essential tasks from <code>metabolicTasks_Essential.txt</code> in the Human-GEM repository. To specify different metabolic tasks, use <code>prepINITModel</code> in RAVEN directly instead.</p>
</div>
<h2 id="prepare-the-transcriptomic-data">Prepare the transcriptomic data</h2>
<p>Data from the condition, tissue, or cell type for which the GEM will be generated is necessary to determine which reactions from the reference model (Human-GEM) should be included. In this case, we use a file with tissues extracted from the GTEx database, which is available in the Zenodo .zip file.</p>
<p>In MATLAB, load the <code>gtexSampForTutorialTPM.txt</code> file from the Zenodo repository.</p>
<pre><code class="language-matlab">% replace 'my/path/' with the path on your system, or change to the directory containing the file
gtex_data = readtable('my/path/gtexSampForTutorialTPM.txt');
[~, n] = size(gtex_data);
numSamp = n-2; %the first two columns are the genes in ENSEMBL and gene symbols format

% take a look at the first few rows and columns of the table
gtex_data(1:5, 1:5)
% ans =
% 
%   5√ó5 table
% 
%            Name              Description      GTEX_111YS_0006_SM_5NQBE    GTEX_1122O_0005_SM_5O99J    GTEX_1128S_0005_SM_5P9HI
%     ___________________    _______________    ________________________    ________________________    ________________________
% 
%     {'ENSG00000223972'}    {'DDX11L1'    }            0.02171                     0.03015                      0.0203         
%     {'ENSG00000227232'}    {'WASH7P'     }              1.555                       2.747                       4.441         
%     {'ENSG00000278267'}    {'MIR6859-1'  }                  0                           0                           0         
%     {'ENSG00000243485'}    {'MIR1302-2HG'}                  0                           0                           0         
%     {'ENSG00000237613'}    {'FAM138A'    }                  0                           0                      0.0576         
</code></pre>
<p>Extract information from the table into a structure called <code>data_struct</code></p>
<pre><code class="language-matlab">% extract the tissue and gene names
data_struct.genes = gtex_data{:, 1}; % gene names
data_struct.tissues = gtex_data.Properties.VariableNames(3:n); % sample (tissue) names
data_struct.levels = gtex_data{:, 3:n}; % gene TPM values
</code></pre>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The name of the data structure (<code>data_struct</code> in this example) is not important. However, its fields (<code>genes</code>, <code>tissues</code>, <code>levels</code>) should <strong>not</strong> be changed.</p>
</div>
<p>Although the original tINIT implementation always compared gene expression in the tissue of interest to the average of all other provided tissues, ftINIT enables the option to instead compare the expression to a threshold value. Here, we will use this alternative approach with a threshold value of 1 TPM.</p>
<pre><code class="language-matlab">data_struct.threshold = 1;
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Exclude the <code>threshold</code> field from the data structure to use the original tINIT approach of comparing the gene expression in your tissue of interest with all other tissues. If you choose this approach, however, you <em><strong>must include the gene expression data from the other tissues</strong></em> so that the algorithm has something to compare to.</p>
</div>
<p>Take a look at <code>data_struct</code> to make sure all the fields are present and have the expected dimensions</p>
<pre><code class="language-matlab">data_struct

% data_struct =
%
%   struct with fields:
% 
%         genes: {56200√ó1 cell}
%       tissues: {1√ó60 cell}
%        levels: [56200√ó60 double]
%     threshold: 1
</code></pre>
<h2 id="run-ftinit">Run ftINIT</h2>
<p>Now all inputs are ready to run ftINIT and extract GEMs specific to the samples based on their corresponding RNA expression profile. ftINIT normally runs in two steps, of which the second is optional. The first step excludes most of the reactions without gene rules (GPRs) from the problem, and the second step determines which of those reactions should be removed. The second step can be omitted, which causes most reactions without GPRs to remain in the model. This is a good option in many cases, for example for structural comparison of models, since removal of reactions without GPRs does not provide any additional information and may add randomness in cases where there are several equally good solutions.</p>
<p>We first run ftINIT without the second step, a setup that is called <code>'1+0'</code>, which typically takes 30 - 60 seconds:</p>
<pre><code class="language-matlab">model1 = ftINIT(prepData, data_struct.tissues{1}, [], [], data_struct, {}, getHumanGEMINITSteps('1+0'), false, true);

model1
% 
%   struct with fields:
% 
%                      id: 'Human-GEM'
%             description: 'Generic genome-scale metabolic model of Homo sapiens'
%                    rxns: {8407√ó1 cell}
%                    mets: {5613√ó1 cell}
%                       S: [5613√ó8407 double]
%                      lb: [8407√ó1 double]
%                      ub: [8407√ó1 double]
%                     rev: [8407√ó1 double]
%                       c: [8407√ó1 double]
%                       b: [5613√ó1 double]
%                   comps: {9√ó1 cell}
%               compNames: {9√ó1 cell}
%                rxnNames: {8407√ó1 cell}
%                 grRules: {8407√ó1 cell}
%              rxnGeneMat: [8407√ó2494 double]
%              subSystems: {8407√ó1 cell}
%                 eccodes: {8407√ó1 cell}
%                rxnNotes: {8407√ó1 cell}
%                   genes: {2494√ó1 cell}
%                metNames: {5613√ó1 cell}
%                metComps: [5613√ó1 double]
%                  inchis: {5613√ó1 cell}
%             metFormulas: {5613√ó1 cell}
%           rxnReferences: {8407√ó1 cell}
%                 rxnFrom: {8407√ó1 cell}
%                 metFrom: {5613√ó1 cell}
%     rxnConfidenceScores: [8407√ó1 double]
%              metCharges: [5613√ó1 int64]
%                 version: '1.12.0'
%              annotation: [1√ó1 struct]
</code></pre>
<p>As an alternative, we can run it with the second step included (<code>'1+1'</code>), which takes roughly 2 - 3 times as long and generates a smaller model:</p>
<pre><code class="language-matlab">model2 = ftINIT(prepData, data_struct.tissues{1}, [], [], data_struct, {}, getHumanGEMINITSteps('1+1'), false, true);

model2
% 
%   struct with fields:
% 
%                      id: 'Human-GEM'
%             description: 'Generic genome-scale metabolic model of Homo sapiens'
%                    rxns: {7752√ó1 cell}
%                    mets: {5490√ó1 cell}
%                       S: [5490√ó7752 double]
%                      lb: [7752√ó1 double]
%                      ub: [7752√ó1 double]
%                     rev: [7752√ó1 double]
%                       c: [7752√ó1 double]
%                       b: [5490√ó1 double]
%                   comps: {9√ó1 cell}
%               compNames: {9√ó1 cell}
%                rxnNames: {7752√ó1 cell}
%                 grRules: {7752√ó1 cell}
%              rxnGeneMat: [7752√ó2494 double]
%              subSystems: {7752√ó1 cell}
%                 eccodes: {7752√ó1 cell}
%                rxnNotes: {7752√ó1 cell}
%                   genes: {2494√ó1 cell}
%                metNames: {5490√ó1 cell}
%                metComps: [5490√ó1 double]
%                  inchis: {5490√ó1 cell}
%             metFormulas: {5490√ó1 cell}
%           rxnReferences: {7752√ó1 cell}
%                 rxnFrom: {7752√ó1 cell}
%                 metFrom: {5490√ó1 cell}
%     rxnConfidenceScores: [7752√ó1 double]
%              metCharges: [5490√ó1 int64]
%                 version: '1.12.0'
%              annotation: [1√ó1 struct]
</code></pre>
<p>It is also possible to supply cell type for cases where tissues are subdivided into cell type, which is not the case here. The method also accepts proteomics data from Human Protein Atlas (HPA) and metabolomics data, but these are not demonstrated here.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The two steps used here are the two most common approaches to run ftINIT and are what we recommend, but they are not the only options. ftINIT can for example be run in a very similar way to the original tINIT algorithm by using the <code>'full'</code> setup.</p>
</div>
<p>It is recommended to change the model <code>id</code> to a more descriptive name than the default of "INITModel". This is particularly useful when analyzing several models together.</p>
<pre><code class="language-matlab">model1.id = data_struct.tissues{1};
</code></pre>
<h2 id="run-ftinit-for-all-samples">Run ftINIT for all samples</h2>
<p>We can now run ftINIT on all samples:</p>
<pre><code class="language-matlab">models = cell(numSamp, 1);
for i = 1:numSamp
    disp(['Model: ' num2str(i) ' of ' num2str(numSamp)])
    models{i} = ftINIT(prepData, data_struct.tissues{i}, [], [], data_struct, {}, getHumanGEMINITSteps('1+0'), false, true);
end

save('models.mat', 'models')
</code></pre>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This loop generates 60 models, which will take a while to run (30 min to 1 hr). For running many models, it is therefore recommended that this is run on a compute cluster.</p>
</div>
<h2 id="quick-examination-of-the-models">Quick examination of the models</h2>
<p>To get a quick structural overview of the models, we perform a t-SNE (t-Distributed Stochastic Neighbor Embedding) transformation of the models' reaction content and export that data to a file for visualization in R.</p>
<pre><code class="language-matlab">baseModel = prepData.refModel;

% now build a matrix saying which reactions are on
compMat = false(length(baseModel.rxns), length(models));

for i = 1:size(compMat,2)
    compMat(:,i) = ismember(baseModel.rxns,models{i}.rxns);
end

% run t-sne
rng(1);  %set random seed to make reproducible
proj_coords = tsne(double(compMat.'), 'Distance', 'hamming', 'NumDimensions', 2, 'Exaggeration', 6, 'Perplexity', 10);

% export to R
d = struct();
d.tsneX = proj_coords(:, 1);
d.tsneY = proj_coords(:, 2);
save('TSNE.mat', 'd');
</code></pre>
<p>We can then visualize the data in R (use e.g., RStudio) using ggplot:</p>
<pre><code class="language-R">library(R.matlab)
library(tidyverse)
library(ggplot2)

#import the data using R.matlab
setwd(&quot;my/path&quot;) #replace with your own path where the exported data was saved
tsneData = readMat(&quot;TSNE.mat&quot;)
x = as.numeric(tsneData$d[,,1]$tsneX)
y = as.numeric(tsneData$d[,,1]$tsneY)

#read the tissues to be able to color the models properly
tissues = read_tsv('gtexSampTissuesForTutorial.txt', col_names = FALSE)[[1]]
tissFact = as.factor(tissues)

#set up a tibble for the plot
df = tibble(x=x, y=y, tissue = tissFact)

color_palette = c('#B5D39B','#E7B56C','#6B97BC','#BC976B','#BC556B','#000000')  

#plot the data
fig = ggplot(df, aes(x = x, y = y, color=tissue, shape=tissue)) +
  geom_point(size=2, stroke = 2) +
  scale_color_manual(values = c(color_palette,color_palette), labels = levels(tissFact) ) +
  scale_shape_manual(values = c(19,19,19,19,19,19,0,0,0,0,0,0), labels=levels(tissFact)) +
  ggplot2::labs(y=expression(&quot;t-SNE y&quot;), x=&quot;t-SNE x&quot;, title=&quot;Structural comparison&quot;) +
  ggplot2::theme_bw() + 
  ggplot2::theme(panel.background = element_rect(&quot;white&quot;, &quot;white&quot;, 0, 0, &quot;white&quot;), panel.grid.major= element_blank(),panel.grid.minor= element_blank()) +
  ggplot2::theme(legend.title = element_blank(),legend.position=&quot;bottom&quot;, legend.text=element_text(size=14)) + guides(colour = guide_legend(nrow = 4), size = guide_legend(nrow = 4), linetype = guide_legend(nrow = 4)) +
  ggplot2::theme(text = element_text(size=14),
                 axis.text.x = element_text(color='black', size=14),
                 axis.text.y = element_text(color='black', size=14))
fig

#export the figure to file
ggsave(
  &quot;StructCompftINIT.png&quot;,
  plot = fig,
  width = 8, height = 8, dpi = 300)
</code></pre>
<p><img alt="Structural comparison" src="../img/StructCompftINIT.png" style="width:95%" /></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.cd18aaf1.min.js"></script>
      
    
  </body>
</html>